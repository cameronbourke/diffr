angular.module("diffr",["ngAnimate","ui.router","diffr.controllers","diffr.filters","diffr.config","diffr.directives","diffr.services","infinite-scroll"]),function(){"use strict";function e(e,t){e.state("search",{url:"/search",templateUrl:"templates/search.html",controller:"SearchCtrl",controllerAs:"search"}).state("compare",{url:"/compare",templateUrl:"templates/compare.html",controller:"CompareCtrl",controllerAs:"compare"}),t.otherwise("/search")}angular.module("diffr.config",[]),angular.module("diffr.config").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t){}angular.module("diffr.controllers",[]),angular.module("diffr.controllers").controller("AppCtrl",e),e.$inject=["$scope","$rootScope"]}(),function(){"use strict";function e(e,t,r,o,i){function c(){s.comparedPhotosList=r.isArrayDefined("comparedUrls")?a:[]}function n(e){var t=a.indexOf(e);a.splice(t,1),s.comparedPhotosList=a,r.setObject("comparedUrls",a)}var s=this,a=r.getObject("comparedUrls");s.removeComparedPhoto=n,c()}angular.module("diffr.controllers").controller("CompareCtrl",e),e.$inject=["$scope","$rootScope","LocalStorageService","FlickrService","StorageService"]}(),function(){"use strict";function e(e,t,r,o,i){function c(e,t){g||(h.searchedPhotos=e),h.searchedText=e,g=!1,h.searchedPhotosList=[],o.getSearchedPhotos(e,t).then(function(t){h.searchedPhotosList=t,-1===h.recentSearches.indexOf(e)&&h.recentSearches.push(e)})}function n(e,t){o.getSearchedPhotos(e,t).then(function(e){e.forEach(function(e){h.searchedPhotosList.push(e)})})}function s(e){c(e,20),h.showRecentsDropdown=!1}function a(){h.showRecentsDropdown=!h.showRecentsDropdown}function l(e){var t="https://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.id+"_"+e.secret+"_b.jpg";-1===p.indexOf(t)?(p.push(t),r.setObject("comparedUrls",p)):console.log("already in comparison list")}function f(){p=r.isArrayDefined("comparedUrls")?r.getObject("comparedUrls"):[]}function u(e){var t="https://farm"+e.farm+".staticflickr.com/"+e.server+"/"+e.id+"_"+e.secret+"_b.jpg";return-1===p.indexOf(t)?!0:!1}function d(){return r.isArrayDefined("comparedUrls")?!0:!1}var h=this;h.modelOptions={updateOn:"default blur",debounce:{"default":1e3,blur:0}},h.recentSearches=[],h.showRecentsDropdown=!1,h.searchedText="selfie";var p,g=!0;h.getSearchedPhotos=c,h.updatePhotos=s,h.toggleRecents=a,h.loadMorePhotos=n,h.addPhotoToCompare=l,h.showCompareButton=u,h.hasComparedPhotos=d,c("selfie",20),f()}angular.module("diffr.controllers").controller("SearchCtrl",e),e.$inject=["$scope","$rootScope","LocalStorageService","FlickrService","StorageService"]}(),function(){"use strict";function e(){return{restrict:"E",template:['<svg class="icon-add-photos" width="100%" height="100%" viewBox="-1 -1 31 25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">',"<title>Two photos stacked with an add icon in the corner</title>","<desc>Lets the user add a new photo to their list of compared images</desc>","<g class='svg-compare-icons'>","<g stroke-width='1'>","<path d='M0.118149935,4.50963844 L11.8374394,0.802704286 L18.1785857,17.7202619 L6.45929629,21.427196 L0.118149935,4.50963844 L0.118149935,4.50963844 Z'></path>","<path d='M18.0003708,0.243357633 L28.6245848,6.10760511 L18.5931005,21.44435 L7.96888653,15.5801025 L18.0003708,0.243357633 L18.0003708,0.243357633 Z'></path>","</g>","<g>",'<ellipse cx="5.54186573" cy="5.15083056" rx="5.54186573" ry="5.15083056"></ellipse>','<path d="M5.18820719,4.80797342 L5.18820719,2.40797342 L5.89552426,2.40797342 L5.89552426,4.80797342 L8.37113402,4.80797342 L8.37113402,5.49368771 L5.89552426,5.49368771',"L5.89552426,7.89368771",'L5.18820719,7.89368771 L5.18820719,5.49368771 L2.71259744,5.49368771 L2.71259744,4.80797342 L5.18820719,4.80797342 Z"></path>',"</g>","</g>","</svg>"].join("")}}angular.module("diffr.directives",[]),angular.module("diffr.directives").directive("iconAddCompare",e)}(),function(){"use strict";function e(){return function(e){return console.log(e),"undefined"!=typeof e?e.substring(0,1).toUpperCase()+e.substring(1):void 0}}angular.module("diffr.filters",[]),angular.module("diffr.filters").filter("capitalize",e)}(),function(){"use strict";function e(e,t){function r(r,i){var c=t.defer();return e.get("https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key="+o+"&tags="+r+"&per_page="+i+"&format=json&nojsoncallback=1").success(function(e){c.resolve(e.photos.photo)}).error(function(e,t){console.log(e),c.reject(e)}),c.promise}var o="52ebcfc572066983269bf5140708086d";this.getSearchedPhotos=r}angular.module("diffr.services",[]),angular.module("diffr.services").service("FlickrService",e),e.$inject=["$http","$q"]}(),function(){"use strict";function e(e){function t(t,r){e.localStorage[t]=r}function r(t,r){return e.localStorage[t]||r}function o(t,r){e.localStorage[t]=JSON.stringify(r)}function i(t){return JSON.parse(e.localStorage[t]||"{}")}function c(t){return"undefined"!=typeof JSON.parse(e.localStorage[t])[0]?!0:!1}this.set=t,this.get=r,this.setObject=o,this.getObject=i,this.isArrayDefined=c}angular.module("diffr.services").service("LocalStorageService",e),e.$inject=["$window"]}(),function(){"use strict";function e(){function e(e,t){s.objects[e]=t}function t(e){return s.objects[e]}function r(e,t){s.arrays[e]=t}function o(e){return s.arrays[e]}function i(e,t){s.strings[e]=t}function c(e){return s.strings[e]}function n(){return s}var s={};s.objects={},s.arrays={},s.strings={},this.setObject=e,this.getObject=t,this.setArray=r,this.getArray=o,this.setString=i,this.getString=c,this.getAllStorage=n}angular.module("diffr.services").service("StorageService",e),e.$inject=[]}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInJvdXRlLmNvbmZpZy5qcyIsImN0cmxzL2FwcC5jb250cm9sbGVyLmpzIiwiY3RybHMvY29tcGFyZS5jb250cm9sbGVyLmpzIiwiY3RybHMvc2VhcmNoLmNvbnRyb2xsZXIuanMiLCJkaXJlY3RpdmVzL2RpcmVjdGl2ZXMuanMiLCJmaWx0ZXJzL2ZpbHRlcnMuanMiLCJzZXJ2aWNlcy9mbGlja3Iuc2VydmljZS5qcyIsInNlcnZpY2VzL2xvY2FsU3RvcmFnZS5zZXJ2aWNlLmpzIiwic2VydmljZXMvc3RvcmFnZS5zZXJ2aWNlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJyb3V0ZUNvbmZpZyIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJjb250cm9sbGVyQXMiLCJvdGhlcndpc2UiLCJjb25maWciLCIkaW5qZWN0IiwiQXBwQ3RybCIsIiRzY29wZSIsIiRyb290U2NvcGUiLCJDb21wYXJlQ3RybCIsIkxvY2FsU3RvcmFnZVNlcnZpY2UiLCJGbGlja3JTZXJ2aWNlIiwiU3RvcmFnZVNlcnZpY2UiLCJnZXRDb21wYXJlZFBob3Rvc0xpc3QiLCJjb21wYXJlIiwiY29tcGFyZWRQaG90b3NMaXN0IiwiaXNBcnJheURlZmluZWQiLCJjb21wYXJlQXJyIiwicmVtb3ZlQ29tcGFyZWRQaG90byIsInVybEluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsInNldE9iamVjdCIsInRoaXMiLCJnZXRPYmplY3QiLCJTZWFyY2hDdHJsIiwiZ2V0U2VhcmNoZWRQaG90b3MiLCJ0ZXh0IiwiYW1vdW50IiwiaW5pdGlhbExvYWQiLCJzZWFyY2giLCJzZWFyY2hlZFBob3RvcyIsInNlYXJjaGVkVGV4dCIsInNlYXJjaGVkUGhvdG9zTGlzdCIsInRoZW4iLCJwaG90b3MiLCJyZWNlbnRTZWFyY2hlcyIsInB1c2giLCJsb2FkTW9yZVBob3RvcyIsImZvckVhY2giLCJlbGVtZW50IiwidXBkYXRlUGhvdG9zIiwibmV3VmFsdWUiLCJzaG93UmVjZW50c0Ryb3Bkb3duIiwidG9nZ2xlUmVjZW50cyIsImFkZFBob3RvVG9Db21wYXJlIiwicGhvdG8iLCJmYXJtIiwic2VydmVyIiwiaWQiLCJzZWNyZXQiLCJuZXdBcnJheSIsImNvbnNvbGUiLCJsb2ciLCJzaG93Q29tcGFyZUJ1dHRvbiIsImhhc0NvbXBhcmVkUGhvdG9zIiwibW9kZWxPcHRpb25zIiwidXBkYXRlT24iLCJkZWJvdW5jZSIsImRlZmF1bHQiLCJibHVyIiwiaWNvbkFkZENvbXBhcmUiLCJyZXN0cmljdCIsInRlbXBsYXRlIiwiam9pbiIsImRpcmVjdGl2ZSIsImNhcGl0YWxpemUiLCJpbnB1dCIsInN1YnN0cmluZyIsInRvVXBwZXJDYXNlIiwiZmlsdGVyIiwiJGh0dHAiLCIkcSIsImRlZmVyIiwiZ2V0IiwiZmxpY2tyS2V5Iiwic3VjY2VzcyIsImRhdGEiLCJyZXNvbHZlIiwiZXJyb3IiLCJzdGF0dXMiLCJyZWplY3QiLCJwcm9taXNlIiwic2VydmljZSIsIiR3aW5kb3ciLCJzZXQiLCJrZXkiLCJ2YWx1ZSIsImxvY2FsU3RvcmFnZSIsImRlZmF1bHRWYWx1ZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZSIsInN0b3JhZ2VPYmplY3QiLCJvYmplY3RzIiwic2V0QXJyYXkiLCJhcnJheXMiLCJnZXRBcnJheSIsInNldFN0cmluZyIsInN0cmluZ3MiLCJnZXRTdHJpbmciLCJnZXRBbGxTdG9yYWdlIl0sIm1hcHBpbmdzIjoiQUFBQUEsUUFBQUMsT0FBQSxTQUNBLFlBQ0EsWUFDQSxvQkFDQSxnQkFDQSxlQUNBLG1CQUNBLGlCQUNBLG9CQ1JBLFdBQ0EsWUFRQSxTQUFBQyxHQUFBQyxFQUFBQyxHQU1BRCxFQUVBRSxNQUFBLFVBQ0FDLElBQUEsVUFDQUMsWUFBQSx3QkFDQUMsV0FBQSxhQUNBQyxhQUFBLFdBR0FKLE1BQUEsV0FDQUMsSUFBQSxXQUNBQyxZQUFBLHlCQUNBQyxXQUFBLGNBQ0FD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QUEsaUJBQUF2RSxHQUVBQSxFQUFBUCIsImZpbGUiOiJkaWZmci5hcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyLm1vZHVsZSgnZGlmZnInLCBbXG4gICduZ0FuaW1hdGUnLFxuICAndWkucm91dGVyJyxcbiAgJ2RpZmZyLmNvbnRyb2xsZXJzJyxcbiAgJ2RpZmZyLmZpbHRlcnMnLFxuICAnZGlmZnIuY29uZmlnJyxcbiAgJ2RpZmZyLmRpcmVjdGl2ZXMnLFxuICAnZGlmZnIuc2VydmljZXMnLFxuICAnaW5maW5pdGUtc2Nyb2xsJ1xuXSk7XG4iLCIoZnVuY3Rpb24oKXtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdkaWZmci5jb25maWcnLCBbXSk7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2RpZmZyLmNvbmZpZycpLmNvbmZpZyhyb3V0ZUNvbmZpZyk7XG5cbiAgcm91dGVDb25maWcuJGluamVjdCA9IFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJ107XG5cbiAgZnVuY3Rpb24gcm91dGVDb25maWcoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gIC8vIElvbmljIHVzZXMgQW5ndWxhclVJIFJvdXRlciB3aGljaCB1c2VzIHRoZSBjb25jZXB0IG9mIHN0YXRlc1xuICAvLyBMZWFybiBtb3JlIGhlcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyLXVpL3VpLXJvdXRlclxuICAvLyBTZXQgdXAgdGhlIHZhcmlvdXMgc3RhdGVzIHdoaWNoIHRoZSBhcHAgY2FuIGJlIGluLlxuICAvLyBFYWNoIHN0YXRlJ3MgY29udHJvbGxlciBjYW4gYmUgZm91bmQgaW4gY29udHJvbGxlcnMuanNcbiAgJHN0YXRlUHJvdmlkZXJcblxuICAuc3RhdGUoJ3NlYXJjaCcsIHtcbiAgICB1cmw6IFwiL3NlYXJjaFwiLFxuICAgIHRlbXBsYXRlVXJsOiBcInRlbXBsYXRlcy9zZWFyY2guaHRtbFwiLFxuICAgIGNvbnRyb2xsZXI6IFwiU2VhcmNoQ3RybFwiLFxuICAgIGNvbnRyb2xsZXJBczogXCJzZWFyY2hcIixcbiAgfSlcblxuICAuc3RhdGUoJ2NvbXBhcmUnLCB7XG4gICAgdXJsOiBcIi9jb21wYXJlXCIsXG4gICAgdGVtcGxhdGVVcmw6IFwidGVtcGxhdGVzL2NvbXBhcmUuaHRtbFwiLFxuICAgIGNvbnRyb2xsZXI6IFwiQ29tcGFyZUN0cmxcIixcbiAgICBjb250cm9sbGVyQXM6IFwiY29tcGFyZVwiLFxuICB9KTtcblxuICAvLyBpZiBub25lIG9mIHRoZSBhYm92ZSBzdGF0ZXMgYXJlIG1hdGNoZWQsIHVzZSB0aGlzIGFzIHRoZSBmYWxsYmFja1xuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvc2VhcmNoJyk7XG59XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnZGlmZnIuY29udHJvbGxlcnMnLCBbXSk7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2RpZmZyLmNvbnRyb2xsZXJzJykuY29udHJvbGxlcignQXBwQ3RybCcsIEFwcEN0cmwpO1xuXG4gIEFwcEN0cmwuJGluamVjdCA9IFsnJHNjb3BlJywgJyRyb290U2NvcGUnXTtcblxuICBmdW5jdGlvbiBBcHBDdHJsKCRzY29wZSwgJHJvb3RTY29wZSkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuXG4gICAgLy8gdmFyaWFibGVzXG5cbiAgICAvLyBtZXRob2RzXG5cbiAgICAvLyBpbml0aWF0b3JzXG5cblxuICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnZGlmZnIuY29udHJvbGxlcnMnKS5jb250cm9sbGVyKCdDb21wYXJlQ3RybCcsIENvbXBhcmVDdHJsKTtcblxuICBDb21wYXJlQ3RybC4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICdMb2NhbFN0b3JhZ2VTZXJ2aWNlJywgJ0ZsaWNrclNlcnZpY2UnLCAnU3RvcmFnZVNlcnZpY2UnXTtcblxuICBmdW5jdGlvbiBDb21wYXJlQ3RybCgkc2NvcGUsICRyb290U2NvcGUsIExvY2FsU3RvcmFnZVNlcnZpY2UsIEZsaWNrclNlcnZpY2UsIFN0b3JhZ2VTZXJ2aWNlKSB7XG4gICAgdmFyIGNvbXBhcmUgPSB0aGlzO1xuXG4gICAgLy8gdmFyaWFibGVzXG4gICAgdmFyIGNvbXBhcmVBcnIgPSBMb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldE9iamVjdCgnY29tcGFyZWRVcmxzJyk7XG5cbiAgICAvLyBtZXRob2RzXG4gICAgY29tcGFyZS5yZW1vdmVDb21wYXJlZFBob3RvID0gcmVtb3ZlQ29tcGFyZWRQaG90bztcblxuICAgIC8vIGluaXRpYXRvcnNcbiAgICBnZXRDb21wYXJlZFBob3Rvc0xpc3QoKTtcblxuXG5cbiAgICBmdW5jdGlvbiBnZXRDb21wYXJlZFBob3Rvc0xpc3QoKSB7XG4gICAgICAvLyBuZWVkIHRvIGtub3cgd2hldGhlciB0aGUgdXNlciBoYXMgcGhvdG9zIHNhdmVkIG9yIG5vdFxuICAgICAgaWYoTG9jYWxTdG9yYWdlU2VydmljZS5pc0FycmF5RGVmaW5lZCgnY29tcGFyZWRVcmxzJykpIHtcbiAgICAgICAgY29tcGFyZS5jb21wYXJlZFBob3Rvc0xpc3QgPSBjb21wYXJlQXJyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29tcGFyZS5jb21wYXJlZFBob3Rvc0xpc3QgPSBbXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmVDb21wYXJlZFBob3RvKHVybCkge1xuICAgICAgdmFyIHVybEluZGV4ID0gY29tcGFyZUFyci5pbmRleE9mKHVybCk7XG4gICAgICBjb21wYXJlQXJyLnNwbGljZSh1cmxJbmRleCwgMSk7XG4gICAgICBjb21wYXJlLmNvbXBhcmVkUGhvdG9zTGlzdCA9IGNvbXBhcmVBcnI7XG4gICAgICAvLyBtYWtlIHN1cmUgdG8gdXBkYXRlIExvY2FsU3RvcmFnZSBhZnRlciB3ZSd2ZSBhc3NpZ25lZCB0aGUgbmV3IGFycmF5IHRvIHNjb3BlXG4gICAgICBMb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldE9iamVjdCgnY29tcGFyZWRVcmxzJywgY29tcGFyZUFycik7XG4gICAgfVxuXG4gIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdkaWZmci5jb250cm9sbGVycycpLmNvbnRyb2xsZXIoJ1NlYXJjaEN0cmwnLCBTZWFyY2hDdHJsKTtcblxuICBTZWFyY2hDdHJsLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJ0xvY2FsU3RvcmFnZVNlcnZpY2UnLCAnRmxpY2tyU2VydmljZScsICdTdG9yYWdlU2VydmljZSddO1xuXG4gIGZ1bmN0aW9uIFNlYXJjaEN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCBMb2NhbFN0b3JhZ2VTZXJ2aWNlLCBGbGlja3JTZXJ2aWNlLCBTdG9yYWdlU2VydmljZSkge1xuICAgIHZhciBzZWFyY2ggPSB0aGlzO1xuXG4gICAgLy8gdmFyaWFibGVzXG4gICAgc2VhcmNoLm1vZGVsT3B0aW9ucyA9IHtcbiAgICAgIC8vIG5lZWQgdG8gZGVib3VuY2UgdGhlIG1vZGVsIGZyb20gdXBkYXRpbmdcbiAgICAgIC8vIHNvIGl0IG9ubHkgZ29lcyB0byBmbGlja3IgYXBpIHdoZW4gdGhlIHVzZXJcbiAgICAgIC8vIGlzIHN1cmUgYWJvdXQgd2hhdCB0aGV5IGFyZSBzZWFyY2hpbmcgZm9yXG4gICAgICB1cGRhdGVPbjogJ2RlZmF1bHQgYmx1cicsXG4gICAgICBkZWJvdW5jZToge1xuICAgICAgICAnZGVmYXVsdCc6IDEgKiAxMDAwLFxuICAgICAgICAnYmx1cic6IDBcbiAgICAgIH1cbiAgICB9O1xuICAgIHNlYXJjaC5yZWNlbnRTZWFyY2hlcyAgICAgID0gW107XG4gICAgc2VhcmNoLnNob3dSZWNlbnRzRHJvcGRvd24gPSBmYWxzZTtcbiAgICBzZWFyY2guc2VhcmNoZWRUZXh0ICAgICAgICA9ICdzZWxmaWUnO1xuICAgIHZhciBpbml0aWFsTG9hZCAgICAgICAgICAgID0gdHJ1ZTtcbiAgICB2YXIgbmV3QXJyYXk7XG5cbiAgICAvLyBtZXRob2RzXG4gICAgc2VhcmNoLmdldFNlYXJjaGVkUGhvdG9zID0gZ2V0U2VhcmNoZWRQaG90b3M7XG4gICAgc2VhcmNoLnVwZGF0ZVBob3RvcyAgICAgID0gdXBkYXRlUGhvdG9zO1xuICAgIHNlYXJjaC50b2dnbGVSZWNlbnRzICAgICA9IHRvZ2dsZVJlY2VudHM7XG4gICAgc2VhcmNoLmxvYWRNb3JlUGhvdG9zICAgID0gbG9hZE1vcmVQaG90b3M7XG4gICAgc2VhcmNoLmFkZFBob3RvVG9Db21wYXJlID0gYWRkUGhvdG9Ub0NvbXBhcmU7XG4gICAgc2VhcmNoLnNob3dDb21wYXJlQnV0dG9uID0gc2hvd0NvbXBhcmVCdXR0b247XG4gICAgc2VhcmNoLmhhc0NvbXBhcmVkUGhvdG9zID0gaGFzQ29tcGFyZWRQaG90b3M7XG5cbiAgICAvLyBpbml0aWF0b3JzXG4gICAgLy8gaW5pdGlhbGx5IGxvYWRpbmcgMjAgcGhvdG9zIHdpdGggdGhlIHRhZyBzZWxmaWVcbiAgICBnZXRTZWFyY2hlZFBob3Rvcygnc2VsZmllJywgMjApO1xuICAgIGdldENvbXBhcmVkUGhvdG9zTGlzdCgpO1xuXG5cblxuICAgIGZ1bmN0aW9uIGdldFNlYXJjaGVkUGhvdG9zKHRleHQsIGFtb3VudCkge1xuICAgICAgaWYoIWluaXRpYWxMb2FkKSB7XG4gICAgICAgIHNlYXJjaC5zZWFyY2hlZFBob3RvcyA9IHRleHQ7XG4gICAgICB9XG4gICAgICBzZWFyY2guc2VhcmNoZWRUZXh0ID0gdGV4dDtcbiAgICAgIGluaXRpYWxMb2FkID0gZmFsc2U7XG4gICAgICBzZWFyY2guc2VhcmNoZWRQaG90b3NMaXN0ID0gW107XG4gICAgICBGbGlja3JTZXJ2aWNlLmdldFNlYXJjaGVkUGhvdG9zKHRleHQsIGFtb3VudCkudGhlbihmdW5jdGlvbihwaG90b3MpIHtcbiAgICAgICAgc2VhcmNoLnNlYXJjaGVkUGhvdG9zTGlzdCA9IHBob3RvcztcbiAgICAgICAgLy8gZG9udHQgd2FudCBkdXBsaWNhdGVzIGluIHRoZSBuZy1yZXBlYXQgZm9yIHJlY2VudCBzZWFyY2hlc1xuICAgICAgICBpZihzZWFyY2gucmVjZW50U2VhcmNoZXMuaW5kZXhPZih0ZXh0KSA9PT0gLTEpIHtcbiAgICAgICAgICBzZWFyY2gucmVjZW50U2VhcmNoZXMucHVzaCh0ZXh0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbG9hZE1vcmVQaG90b3ModGV4dCwgYW1vdW50KSB7XG4gICAgICBGbGlja3JTZXJ2aWNlLmdldFNlYXJjaGVkUGhvdG9zKHRleHQsIGFtb3VudCkudGhlbihmdW5jdGlvbihwaG90b3MpIHtcbiAgICAgICAgLy8gbmVlZCB0byBhZGQgZWFjaCBwaG90byB0byB0aGUgZW5kIG9mIHRoZSBzZWFyY2hlZFBob3Rvc0xpc3QgYXJyYXlcbiAgICAgICAgcGhvdG9zLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xuICAgICAgICAgIHNlYXJjaC5zZWFyY2hlZFBob3Rvc0xpc3QucHVzaChlbGVtZW50KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB1cGRhdGVQaG90b3MobmV3VmFsdWUpIHtcbiAgICAgIC8vIGRvbid0IHVwZGF0ZSB0aGUgcGhvdG9zIHdoZW4gdGhlIHNlYXJjaCBiYXIgaXMgZW1wdHlcbiAgICAgIGlmKG5ld1ZhbHVlICE9PSAnJyB8fCB0eXBlb2YgbmV3VmFsdWUgIT09ICd1bmRlZmluZWQnIHx8ICFmYWxzZSkge1xuICAgICAgICBnZXRTZWFyY2hlZFBob3RvcyhuZXdWYWx1ZSwgMjApO1xuICAgICAgICBzZWFyY2guc2hvd1JlY2VudHNEcm9wZG93biA9IGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRvZ2dsZVJlY2VudHMoKSB7XG4gICAgICBzZWFyY2guc2hvd1JlY2VudHNEcm9wZG93biA9ICFzZWFyY2guc2hvd1JlY2VudHNEcm9wZG93bjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGRQaG90b1RvQ29tcGFyZShwaG90bykge1xuICAgICAgLy8gbmVlZCB0byBjb25zdHJ1Y3QgdGhlIHVuaXF1ZSB1cmwgZm9yIHRoZSBwaG90b1xuICAgICAgdmFyIHVybCA9ICdodHRwczovL2Zhcm0nICsgcGhvdG8uZmFybSArICcuc3RhdGljZmxpY2tyLmNvbS8nICsgcGhvdG8uc2VydmVyICsgJy8nICsgcGhvdG8uaWQgKyAnXycgKyBwaG90by5zZWNyZXQgKyAnX2IuanBnJztcbiAgICAgIGlmKG5ld0FycmF5LmluZGV4T2YodXJsKSA9PT0gLTEpIHtcbiAgICAgICAgbmV3QXJyYXkucHVzaCh1cmwpO1xuICAgICAgICBMb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldE9iamVjdCgnY29tcGFyZWRVcmxzJywgbmV3QXJyYXkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2FscmVhZHkgaW4gY29tcGFyaXNvbiBsaXN0Jyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0Q29tcGFyZWRQaG90b3NMaXN0KCkge1xuICAgICAgaWYoTG9jYWxTdG9yYWdlU2VydmljZS5pc0FycmF5RGVmaW5lZCgnY29tcGFyZWRVcmxzJykpIHtcbiAgICAgICAgbmV3QXJyYXkgPSBMb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldE9iamVjdCgnY29tcGFyZWRVcmxzJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdBcnJheSA9IFtdO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dDb21wYXJlQnV0dG9uKHBob3RvKSB7XG4gICAgICB2YXIgdXJsID0gJ2h0dHBzOi8vZmFybScgKyBwaG90by5mYXJtICsgJy5zdGF0aWNmbGlja3IuY29tLycgKyBwaG90by5zZXJ2ZXIgKyAnLycgKyBwaG90by5pZCArICdfJyArIHBob3RvLnNlY3JldCArICdfYi5qcGcnO1xuICAgICAgLy8gaWYgdGhlIHBob3RvIGlzIGFscmVhZHkgc2F2ZWQsIGRvbid0IHNob3cgdGhlIGFkZCB0byBjb21wYXJlIGJ0blxuICAgICAgaWYobmV3QXJyYXkuaW5kZXhPZih1cmwpID09PSAtMSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYXNDb21wYXJlZFBob3RvcygpIHtcbiAgICAgIC8vIG9ubHkgcHVsc2UgdGhlIGNvbXBhcmUgcGhvdG9zIG5hdiBidXR0b24gaWYgdGhlcmUgYXJlIHBob3RvcyBzYXZlZFxuICAgICAgaWYoTG9jYWxTdG9yYWdlU2VydmljZS5pc0FycmF5RGVmaW5lZCgnY29tcGFyZWRVcmxzJykpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdkaWZmci5kaXJlY3RpdmVzJywgW10pO1xuXG4gIC8vIGFsbG93cyB1cyB0byB1c2UgdGhlIGJlbmVmaXRzIG9mIGlubGluZSBzdmcsIHdpdGhvdXQgdGhlIGNsdXR0ZXIgb2YgdGhlIG1hcmt1cCBpbiBvdXIgaHRtbFxuICBmdW5jdGlvbiBpY29uQWRkQ29tcGFyZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgIHRlbXBsYXRlOiBbXG4gICAgICAnPHN2ZyBjbGFzcz1cImljb24tYWRkLXBob3Rvc1wiIHdpZHRoPVwiMTAwJVwiIGhlaWdodD1cIjEwMCVcIiB2aWV3Qm94PVwiLTEgLTEgMzEgMjVcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgeG1sbnM6eGxpbms9XCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCI+JyxcbiAgICAgICAgXCI8dGl0bGU+VHdvIHBob3RvcyBzdGFja2VkIHdpdGggYW4gYWRkIGljb24gaW4gdGhlIGNvcm5lcjwvdGl0bGU+XCIsXG4gICAgICAgIFwiPGRlc2M+TGV0cyB0aGUgdXNlciBhZGQgYSBuZXcgcGhvdG8gdG8gdGhlaXIgbGlzdCBvZiBjb21wYXJlZCBpbWFnZXM8L2Rlc2M+XCIsXG4gICAgICAgIC8vIHRhcmdldCB0aGlzIGNsYXNzIHRvIGNoYW5nZSBmaWxsLCBzdHJva2UgY29sb3VyIGV0YyBpbiB0aGUgY3NzXG4gICAgICAgIFwiPGcgY2xhc3M9J3N2Zy1jb21wYXJlLWljb25zJz5cIixcbiAgICAgICAgICBcIjxnIHN0cm9rZS13aWR0aD0nMSc+XCIsXG4gICAgICAgICAgICBcIjxwYXRoIGQ9J00wLjExODE0OTkzNSw0LjUwOTYzODQ0IEwxMS44Mzc0Mzk0LDAuODAyNzA0Mjg2IEwxOC4xNzg1ODU3LDE3LjcyMDI2MTkgTDYuNDU5Mjk2MjksMjEuNDI3MTk2IEwwLjExODE0OTkzNSw0LjUwOTYzODQ0IEwwLjExODE0OTkzNSw0LjUwOTYzODQ0IFonPjwvcGF0aD5cIixcbiAgICAgICAgICAgIFwiPHBhdGggZD0nTTE4LjAwMDM3MDgsMC4yNDMzNTc2MzMgTDI4LjYyNDU4NDgsNi4xMDc2MDUxMSBMMTguNTkzMTAwNSwyMS40NDQzNSBMNy45Njg4ODY1MywxNS41ODAxMDI1IEwxOC4wMDAzNzA4LDAuMjQzMzU3NjMzIEwxOC4wMDAzNzA4LDAuMjQzMzU3NjMzIFonPjwvcGF0aD5cIixcbiAgICAgICAgICBcIjwvZz5cIixcbiAgICAgICAgICBcIjxnPlwiLFxuICAgICAgICAgICAgJzxlbGxpcHNlIGN4PVwiNS41NDE4NjU3M1wiIGN5PVwiNS4xNTA4MzA1NlwiIHJ4PVwiNS41NDE4NjU3M1wiIHJ5PVwiNS4xNTA4MzA1NlwiPjwvZWxsaXBzZT4nLFxuICAgICAgICAgICAgJzxwYXRoIGQ9XCJNNS4xODgyMDcxOSw0LjgwNzk3MzQyIEw1LjE4ODIwNzE5LDIuNDA3OTczNDIgTDUuODk1NTI0MjYsMi40MDc5NzM0MiBMNS44OTU1MjQyNiw0LjgwNzk3MzQyIEw4LjM3MTEzNDAyLDQuODA3OTczNDIgTDguMzcxMTM0MDIsNS40OTM2ODc3MSBMNS44OTU1MjQyNiw1LjQ5MzY4NzcxJywgJ0w1Ljg5NTUyNDI2LDcuODkzNjg3NzEnLCAnTDUuMTg4MjA3MTksNy44OTM2ODc3MSBMNS4xODgyMDcxOSw1LjQ5MzY4NzcxIEwyLjcxMjU5NzQ0LDUuNDkzNjg3NzEgTDIuNzEyNTk3NDQsNC44MDc5NzM0MiBMNS4xODgyMDcxOSw0LjgwNzk3MzQyIFpcIj48L3BhdGg+JyxcbiAgICAgICAgICAnPC9nPicsXG4gICAgICAgICc8L2c+JyxcbiAgICAgICc8L3N2Zz4nXG4gICAgICBdLmpvaW4oJycpXG4gICAgfTtcbiAgfVxuXG4gIGFuZ3VsYXJcbiAgLm1vZHVsZSgnZGlmZnIuZGlyZWN0aXZlcycpXG4gIC5kaXJlY3RpdmUoJ2ljb25BZGRDb21wYXJlJywgaWNvbkFkZENvbXBhcmUpO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2RpZmZyLmZpbHRlcnMnLCBbXSk7XG5cbiAgZnVuY3Rpb24gY2FwaXRhbGl6ZSgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oaW5wdXQpIHtcbiAgICAgIGNvbnNvbGUubG9nKGlucHV0KTtcbiAgICAgIGlmKHR5cGVvZiBpbnB1dCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGlucHV0LnN1YnN0cmluZygwLDEpLnRvVXBwZXJDYXNlKCkgKyBpbnB1dC5zdWJzdHJpbmcoMSk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdkaWZmci5maWx0ZXJzJylcbiAgICAuZmlsdGVyKCdjYXBpdGFsaXplJywgY2FwaXRhbGl6ZSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnZGlmZnIuc2VydmljZXMnLCBbXSk7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2RpZmZyLnNlcnZpY2VzJykuc2VydmljZSgnRmxpY2tyU2VydmljZScsIEZsaWNrclNlcnZpY2UpO1xuXG4gIC8vIG5lZWQgdGhlIGluamVjdCBtZXRob2QgZm9yIG1pbmlmaWNhdGlvblxuICBGbGlja3JTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJ107XG5cbiAgZnVuY3Rpb24gRmxpY2tyU2VydmljZSgkaHR0cCwgJHEpIHtcblxuICAgIC8vIHZhcmlhYmxlc1xuICAgIHZhciBmbGlja3JLZXkgPSAnNTJlYmNmYzU3MjA2Njk4MzI2OWJmNTE0MDcwODA4NmQnLFxuICAgIGZsaWNrclNlY3JldCAgPSAnZThkNTNhMmZmNzBiMTA3Nyc7XG5cbiAgICAvLyBtZXRob2RzXG4gICAgdGhpcy5nZXRTZWFyY2hlZFBob3RvcyA9IGdldFNlYXJjaGVkUGhvdG9zO1xuXG4gICAgLy8gaW5pdGlhdG9yc1xuXG5cblxuICAgIGZ1bmN0aW9uIGdldFNlYXJjaGVkUGhvdG9zKHRleHQsIGFtb3VudCkge1xuICAgICAgLy8gbmVlZCB0byB1c2UgYSBwcm9taXNlIGJlY3Vhc2UgJGh0dHAncyBzdWNjZXNzIGFuZCBlcnJvciBjYW4gYmUgdW5yZWxpYWJsZVxuICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAuZ2V0KCdodHRwczovL2FwaS5mbGlja3IuY29tL3NlcnZpY2VzL3Jlc3QvP21ldGhvZD1mbGlja3IucGhvdG9zLnNlYXJjaCZhcGlfa2V5PScgKyBmbGlja3JLZXkgKyAnJnRhZ3M9JyArIHRleHQgKyAnJnBlcl9wYWdlPScgKyBhbW91bnQgKyAnJmZvcm1hdD1qc29uJm5vanNvbmNhbGxiYWNrPTEnKVxuICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEucGhvdG9zLnBob3RvKTtcbiAgICAgIH0pXG4gICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyb3IsIHN0YXR1cykge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIGRlZmVyLnJlamVjdChlcnJvcik7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XG5cbiAgICB9XG5cblxuICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnZGlmZnIuc2VydmljZXMnKS5zZXJ2aWNlKCdMb2NhbFN0b3JhZ2VTZXJ2aWNlJywgTG9jYWxTdG9yYWdlU2VydmljZSk7XG5cbiAgTG9jYWxTdG9yYWdlU2VydmljZS4kaW5qZWN0ID0gWyckd2luZG93J107XG5cbiAgZnVuY3Rpb24gTG9jYWxTdG9yYWdlU2VydmljZSgkd2luZG93KSB7XG5cbiAgICAvLyB2YXJpYWJsZXNcblxuICAgIC8vIG1ldGhvZHNcbiAgICB0aGlzLnNldCAgICAgICAgICAgID0gc2V0O1xuICAgIHRoaXMuZ2V0ICAgICAgICAgICAgPSBnZXQ7XG4gICAgdGhpcy5zZXRPYmplY3QgICAgICA9IHNldE9iamVjdDtcbiAgICB0aGlzLmdldE9iamVjdCAgICAgID0gZ2V0T2JqZWN0O1xuICAgIHRoaXMuaXNBcnJheURlZmluZWQgPSBpc0FycmF5RGVmaW5lZDtcblxuICAgIC8vIGluaXRpYXRvcnNcblxuXG5cbiAgICBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkge1xuICAgIFx0JHdpbmRvdy5sb2NhbFN0b3JhZ2Vba2V5XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldChrZXksIGRlZmF1bHRWYWx1ZSkge1xuICAgIFx0cmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlW2tleV0gfHwgZGVmYXVsdFZhbHVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldE9iamVjdChrZXksIHZhbHVlKSB7XG4gICAgICAkd2luZG93LmxvY2FsU3RvcmFnZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE9iamVjdChrZXkpIHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cubG9jYWxTdG9yYWdlW2tleV0gfHwgJ3t9Jyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNBcnJheURlZmluZWQoa2V5KSB7XG4gICAgICBpZih0eXBlb2YgSlNPTi5wYXJzZSgkd2luZG93LmxvY2FsU3RvcmFnZVtrZXldKVswXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdkaWZmci5zZXJ2aWNlcycpLnNlcnZpY2UoJ1N0b3JhZ2VTZXJ2aWNlJywgU3RvcmFnZVNlcnZpY2UpO1xuXG4gIFN0b3JhZ2VTZXJ2aWNlLiRpbmplY3QgPSBbXTtcblxuICBmdW5jdGlvbiBTdG9yYWdlU2VydmljZSgpIHtcblxuICAgIC8vIHZhcmlhYmxlc1xuICAgIHZhciBzdG9yYWdlT2JqZWN0ICAgICAgPSB7fTtcbiAgICBzdG9yYWdlT2JqZWN0Lm9iamVjdHMgID0ge307XG4gICAgc3RvcmFnZU9iamVjdC5hcnJheXMgICA9IHt9O1xuICAgIHN0b3JhZ2VPYmplY3Quc3RyaW5ncyAgPSB7fTtcblxuICAgIC8vIG1ldGhvZHNcbiAgICB0aGlzLnNldE9iamVjdCAgICAgPSBzZXRPYmplY3Q7XG4gICAgdGhpcy5nZXRPYmplY3QgICAgID0gZ2V0T2JqZWN0O1xuICAgIHRoaXMuc2V0QXJyYXkgICAgICA9IHNldEFycmF5O1xuICAgIHRoaXMuZ2V0QXJyYXkgICAgICA9IGdldEFycmF5O1xuICAgIHRoaXMuc2V0U3RyaW5nICAgICA9IHNldFN0cmluZztcbiAgICB0aGlzLmdldFN0cmluZyAgICAgPSBnZXRTdHJpbmc7XG4gICAgdGhpcy5nZXRBbGxTdG9yYWdlID0gZ2V0QWxsU3RvcmFnZTtcblxuICAgIC8vIGluaXRpYXRvcnNcblxuXG5cbiAgICBmdW5jdGlvbiBzZXRPYmplY3Qoa2V5LCB2YWx1ZSkge1xuICAgICAgc3RvcmFnZU9iamVjdC5vYmplY3RzW2tleV0gPSB2YWx1ZTtcblx0XHR9XG5cblx0XHRmdW5jdGlvbiBnZXRPYmplY3Qoa2V5KSB7XG5cdFx0XHRyZXR1cm4gc3RvcmFnZU9iamVjdC5vYmplY3RzW2tleV07XG5cdFx0fVxuXG4gICAgZnVuY3Rpb24gc2V0QXJyYXkoa2V5LCB2YWx1ZSkge1xuICAgICAgc3RvcmFnZU9iamVjdC5hcnJheXNba2V5XSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEFycmF5KGtleSkge1xuICAgICAgcmV0dXJuIHN0b3JhZ2VPYmplY3QuYXJyYXlzW2tleV07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0U3RyaW5nKGtleSwgdmFsdWUpIHtcbiAgICAgIHN0b3JhZ2VPYmplY3Quc3RyaW5nc1trZXldID0gdmFsdWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0U3RyaW5nKGtleSkge1xuICAgICAgcmV0dXJuIHN0b3JhZ2VPYmplY3Quc3RyaW5nc1trZXldO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEFsbFN0b3JhZ2UoKSB7XG4gICAgICByZXR1cm4gc3RvcmFnZU9iamVjdDtcbiAgICB9XG5cbiAgfVxuXG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9